# Telegram Bot 菜单使用指南

## 📱 菜单功能说明

你的 Telegram 机器人现在支持三种类型的菜单界面：

### 1. 命令菜单（BotCommand Menu）

这是 Telegram 原生的命令菜单，会显示在聊天输入框左侧的 "/" 按钮中。

**如何访问：**
- 点击聊天输入框左侧的 **"/"** 按钮
- 或直接输入 `/` 开始输入命令名

**可用命令：**

#### 基础命令（所有用户）
- `/start` - 显示帮助信息和功能介绍
- `/help` - 查看使用说明
- `/myid` - 获取你的 Telegram 用户 ID

#### 管理员命令（需要管理员权限）
- `/menu` - 打开交互式菜单界面 🎮 **（推荐）**
- `/stats` - 查看群组统计信息
- `/status` - 查看机器人运行状态
- `/summary [日期]` - 生成指定日期的总结
  - 例如：`/summary 1`（昨天）
  - 例如：`/summary 2024-11-12`（指定日期）
- `/summary_history` - 查看历史总结记录

---

### 2. 交互式按钮菜单（InlineKeyboard Menu）

这是最推荐使用的菜单方式，通过 `/menu` 命令打开。

**特点：**
- 🎮 图形化界面，操作简单直观
- 📊 支持实时生成总结
- 💾 支持查看已保存的总结
- 🔄 可以多次操作，无需重复输入命令

**功能列表：**

```
🤖 Telegram Note Taker 控制面板

┌─────────────────────────────────────┐
│  📊 获取24小时总结  │  📈 获取3天总结  │
├─────────────────────────────────────┤
│      🔥 生成今日24小时总结           │
├─────────────────────────────────────┤
│      📋 查看已保存的总结             │
├─────────────────────────────────────┤
│           ❌ 关闭菜单               │
└─────────────────────────────────────┘
```

**使用方法：**

1. **获取实时总结**
   - 点击 "📊 获取24小时总结" 或 "📈 获取3天总结"
   - 选择要分析的群组
   - 等待 AI 生成总结
   - 总结会直接显示在聊天中

2. **生成并保存今日总结**
   - 点击 "🔥 生成今日24小时总结"
   - 选择群组
   - AI 会生成过去24小时的总结
   - **自动保存到历史记录**，可以稍后查看

3. **查看已保存的总结**
   - 点击 "📋 查看已保存的总结"
   - 选择时间范围（1天/3天）
   - 查看之前生成的总结记录

---

### 3. 在私聊和群组中使用

#### 在群组中使用
```
✅ 直接发送命令，如 /menu
✅ 总结会针对当前群组生成
✅ 统计信息显示当前群组数据
```

#### 在私聊中使用
```
✅ 发送命令后会显示群组选择界面
✅ 可以管理多个群组的总结
✅ 查看不同群组的统计信息
```

---

## 🎯 快速开始

### 第一次使用

1. **添加机器人到群组**
   - 将机器人添加为群组成员
   - 确保机器人有读取消息的权限

2. **获取你的用户ID**
   ```
   /myid
   ```
   将显示的 ID 添加到 `.env` 文件的 `ADMIN_IDS` 配置中

3. **打开菜单**
   ```
   /menu
   ```
   开始使用交互式菜单

4. **生成第一个总结**
   - 点击 "🔥 生成今日24小时总结"
   - 选择群组
   - 等待 AI 生成结果

---

## 💡 使用技巧

### 1. 最佳实践

**日常使用流程：**
```
1. 每天开始时: /menu → 查看已保存的总结
2. 需要快速了解: /menu → 获取24小时总结
3. 深度分析: /menu → 获取3天总结
4. 定期保存: /menu → 生成今日总结
```

### 2. 命令参数说明

**summary 命令参数：**
```bash
# 获取昨天的总结
/summary 1

# 获取3天前的总结
/summary 3

# 获取指定日期的总结
/summary 2024-11-12
```

### 3. 权限说明

| 功能 | 所有用户 | 管理员 |
|------|---------|--------|
| 查看帮助 | ✅ | ✅ |
| 获取自己的ID | ✅ | ✅ |
| 使用菜单 | ❌ | ✅ |
| 生成总结 | ❌ | ✅ |
| 查看统计 | ❌ | ✅ |

---

## 🔧 配置说明

### 设置管理员

在 `.env` 文件中配置：
```bash
# 单个管理员
ADMIN_IDS=123456789

# 多个管理员（用逗号分隔）
ADMIN_IDS=123456789,987654321,456789123
```

### 设置允许的群组

```bash
# 允许所有群组（默认）
ALLOWED_GROUPS=

# 限制特定群组
ALLOWED_GROUPS=-1001234567890,-1009876543210
```

### AI 总结配置

```bash
# 启用 AI 总结
ENABLE_AI_SUMMARY=true

# 总结语言
SUMMARY_LANGUAGE=zh  # zh=中文, en=英文, ja=日文

# 总结长度
SUMMARY_LENGTH=medium  # short=简短, medium=中等, long=详细

# 总结风格
SUMMARY_STYLE=bullet  # bullet=要点列表, paragraph=段落, structured=结构化
```

---

## 🐛 常见问题

### Q1: 命令菜单没有显示？
**A:** 重启机器人后，菜单会自动设置。如果还是没有显示：
1. 在聊天中发送任何消息给机器人
2. 等待几秒钟
3. 点击输入框的 "/" 按钮查看

### Q2: 提示"只有管理员可以使用"？
**A:** 需要将你的用户 ID 添加到 `.env` 配置：
1. 发送 `/myid` 获取你的 ID
2. 在 `.env` 中设置 `ADMIN_IDS=你的ID`
3. 重启机器人

### Q3: 总结生成失败？
**A:** 检查以下内容：
- 群组是否有足够的消息（默认需要至少10条）
- AI API 配置是否正确
- 查看日志文件 `logs/telegram_notetaker.log`

### Q4: 菜单按钮无响应？
**A:** 可能的原因：
- 网络连接问题
- 消息已过期（重新发送 `/menu`）
- 机器人权限不足

---

## 📝 示例场景

### 场景 1: 早晨查看昨日总结
```
你: /menu
Bot: [显示菜单界面]
你: [点击 "查看已保存的总结"]
你: [选择 "过去1天"]
Bot: [显示昨天的总结内容]
```

### 场景 2: 快速了解最新讨论
```
你: /menu
Bot: [显示菜单界面]
你: [点击 "获取24小时总结"]
你: [选择群组]
Bot: [实时生成并显示最新24小时的对话总结]
```

### 场景 3: 保存当天重要讨论
```
你: /menu
Bot: [显示菜单界面]
你: [点击 "生成今日24小时总结"]
你: [选择群组]
Bot: [生成总结并保存到历史记录]
Bot: 💾 此总结已自动保存到历史记录
```

### 场景 4: 查看特定日期的讨论
```
你: /summary 2024-11-10
Bot: [显示群组选择界面]（如果在私聊中）
你: [选择群组]
Bot: [显示 2024-11-10 的总结]
```

---

## 🎨 菜单自定义

如果你想自定义菜单，可以编辑 `src/bot.py` 文件：

### 修改命令菜单
找到 `_setup_bot_commands` 方法：
```python
commands = [
    BotCommand("start", "你的描述"),
    BotCommand("custom", "你的自定义命令"),
]
```

### 修改按钮菜单
找到 `menu_command` 方法，修改 `keyboard` 数组：
```python
keyboard = [
    [
        InlineKeyboardButton("你的按钮", callback_data="your_action"),
    ],
]
```

---

## 📞 获取支持

如果遇到问题：
1. 查看日志文件：`logs/telegram_notetaker.log`
2. 使用 `/status` 命令检查机器人状态
3. 确认配置文件 `.env` 设置正确

---

## 🚀 进阶功能

### 自动定时总结
机器人会在每天 00:00 自动生成前一天的总结（如果启用了 AI 功能）

### 批量管理
在私聊中使用命令可以管理多个群组：
- 一次查看多个群组的总结
- 批量生成历史总结
- 对比不同群组的活跃度

---

**享受你的智能 Telegram 机器人！** 🎉
